[
 {
  "docstatus": 0,
  "doctype": "Client Script",
  "dt": "POS Invoice",
  "enabled": 1,
  "modified": "2021-11-12 20:23:17.249186",
  "name": "POS Invoice-Form",
  "parent": null,
  "parentfield": null,
  "parenttype": null,
  "script": "frappe.ui.form.on('POS Invoice', {\n    refresh(frm) {\n\t    if(frm.doc.__islocal){\n    \t\tfrappe.db.get_value(\"Fiscal Year\",{\"disabled\":0,\"year_start_date\":[\"<=\",frm.doc.posting_date],\"year_end_date\":[\">=\",frm.doc.posting_date]},\"year\",(y)=>{\n    \t\t        frm.set_value(\"financial_year\",y.year)\n    \t\t})\n\t\t}\n\t},\n    validate(frm){\n        if(frm.doc.is_return==1 && frm.doc.return_against != undefined){\n\t\t    frappe.db.get_value(\"POS Invoice\",{\"name\":frm.doc.return_against},\"transaction_id\",(t)=>{\n\t\t        \n    \t\t        if(frm.doc.transaction_id == t.transaction_id){\n    \t\t            frm.set_value(\"transaction_id\",undefined);\n    \t\t        }\n    \t\t})\n\t\t}\n\t\tif(frm.doc.amended_from != undefined){\n\t\t    frappe.db.get_value(\"POS Invoice\",{\"name\":frm.doc.amended_from},\"transaction_id\",(t)=>{\n\t\t        \n    \t\t        if(frm.doc.transaction_id == t.transaction_id){\n    \t\t            frm.set_value(\"transaction_id\",undefined);\n    \t\t        }\n    \t\t})\n\t\t}\n        if(frm.doc.transaction_id!=null && frm.doc.transaction_id!=undefined){\n\t        for(var i=0;i<frm.doc.payments.length;i++){\n\t            if(frm.doc.payments[i].mode_of_payment==\"Online\" && frm.doc.payments[i].mode_of_payment!=undefined && frm.doc.payments[i].base_amount>0){\n\t                frm.doc.payments[i].transaction_id=frm.doc.transaction_id\n\t            }\n\t            if(frm.doc.is_return==1){\n\t                if(frm.doc.payments[i].mode_of_payment==\"Online\" && frm.doc.payments[i].mode_of_payment!=undefined && frm.doc.payments[i].base_amount<0){\n\t                    frm.doc.payments[i].transaction_id=frm.doc.transaction_id\n\t                            if(frm.doc.is_return==1 && frm.doc.return_against != undefined){\n                        \t\t    frappe.db.get_value(\"POS Invoice\",{\"name\":frm.doc.return_against},\"transaction_id\",(t)=>{\n            \t\t        \n                \t\t        if(frm.doc.payments[i].transaction_id == t.transaction_id){\n                \t\t            frm.doc.payments[i].transaction_id = undefined;\n                \t\t        }\n                \t\t})\n            \t\t}\n\t                   } \n\t                }\n\t        }\n\t    }\n\t    if(frm.doc.payment_source!=null && frm.doc.payment_source!=undefined){\n\t        for(var k=0;k<frm.doc.payments.length;k++){\n\t            if(frm.doc.payments[k].mode_of_payment==\"Online\" && frm.doc.payments[k].mode_of_payment!=undefined && frm.doc.payments[k].base_amount>0){\n\t                frm.doc.payments[k].payment_source=frm.doc.payment_source\n\t            }\n\t            if(frm.doc.is_return==1){\n\t                if(frm.doc.payments[k].mode_of_payment==\"Online\" && frm.doc.payments[k].mode_of_payment!=undefined && frm.doc.payments[k].base_amount<0 && frm.doc.transaction_id!=undefined){\n\t                    frm.doc.payments[k].payment_source=frm.doc.payment_source\n\t                }\n\t            }\n\t        }\n\t    }\n\t\tif (frm.doc.payments!=null) {\n\t\t\tfor(var j=0;j<frm.doc.payments.length;j++){\n\t            if(frm.doc.payments[j].mode_of_payment==\"Online\" && frm.doc.payments[j].mode_of_payment!=undefined && frm.doc.payments[j].base_amount>0){\n\t                if(frm.doc.payments[j].transaction_id==null||frm.doc.payments[j].transaction_id==undefined||frm.doc.payments[j].transaction_id==''){\n\t                    frappe.msgprint(__(\"Unable to submit the invoice due to unavailability of Transaction Id. Please provide the transaction Id to submit the invoice\"));\n\t\t\t            frappe.validated = false;\n\t                }\n\t            }\n\t        }\n\t\t}\n\t}\n})",
  "view": "Form"
 },
 {
  "docstatus": 0,
  "doctype": "Client Script",
  "dt": "Item Attribute",
  "enabled": 1,
  "modified": "2021-07-27 11:14:47.910898",
  "name": "Item Attribute-Form",
  "parent": null,
  "parentfield": null,
  "parenttype": null,
  "script": "frappe.ui.form.on('Item Attribute', {\n\trefresh(frm) {\n\t    var abbr_field = frappe.meta.get_docfield(\"Item Attribute Value\",\"abbr\", cur_frm.doc.name);\n            abbr_field.set_only_once = 1;\n\t},\n\tbefore_save: function(frm,cdt,cdn){\n\t    $.each(frm.doc.item_attribute_values, function(idx,item){\n\t       var name=frm.doc.name;\n\t       var str = name.toLowerCase();\n\t       if(str.includes(\"size\")){\n    \t    if(item.abbr.length>=4){\n    \t        frappe.validate=false;\n    \t        frappe.throw(__(\"The abbreviation length should be less than 3 characters. The maximum field length has been exceeded, please update.\"))\n    \t    }\n    \t}\n\t       if(str.includes(\"colour\")){\n    \t    if(item.abbr.length>=3){\n    \t        frappe.validate=false;\n    \t        frappe.throw(__(\"The abbreviation length should be less than 2 characters. The maximum field length has been exceeded, please update.\"))\n    \t    }\n    \t}\n\t       if(str.includes(\"color\")){\n    \t    if(item.abbr.length>=3){\n    \t        frappe.validate=false;\n    \t        frappe.throw(__(\"The abbreviation length should be less than 2 characters. The maximum field length has been exceeded, please update.\"))\n    \t    }\n    \t}\n\t    })\n\t}\n})",
  "view": "Form"
 },
 {
  "docstatus": 0,
  "doctype": "Client Script",
  "dt": "Collection Details",
  "enabled": 1,
  "modified": "2021-07-27 11:18:03.249747",
  "name": "Collection Details-List",
  "parent": null,
  "parentfield": null,
  "parenttype": null,
  "script": "frappe.listview_settings['Collection Details'] = {\n\thide_name_column: true\n};",
  "view": "List"
 },
 {
  "docstatus": 0,
  "doctype": "Client Script",
  "dt": "Style Details",
  "enabled": 1,
  "modified": "2021-07-27 11:18:31.539923",
  "name": "Style Details-List",
  "parent": null,
  "parentfield": null,
  "parenttype": null,
  "script": "frappe.listview_settings['Style Details'] = {\n\thide_name_column: true\n};",
  "view": "List"
 },
 {
  "docstatus": 0,
  "doctype": "Client Script",
  "dt": "Launch Details",
  "enabled": 1,
  "modified": "2021-07-27 11:19:09.818010",
  "name": "Launch Details-List",
  "parent": null,
  "parentfield": null,
  "parenttype": null,
  "script": "frappe.listview_settings['Launch Details'] = {\n\thide_name_column: true\n};",
  "view": "List"
 },
 {
  "docstatus": 0,
  "doctype": "Client Script",
  "dt": "Pick List",
  "enabled": 1,
  "modified": "2021-07-27 11:19:55.950892",
  "name": "Pick List-Form",
  "parent": null,
  "parentfield": null,
  "parenttype": null,
  "script": "frappe.ui.form.on('Pick List', {\n\trefresh(frm) {\n\t    if(frm.doc.__islocal){\n    \t\tfrappe.db.get_value(\"Fiscal Year\",{\"disabled\":0,\"year_start_date\":[\"<=\",frappe.utils.nowdate],\"year_end_date\":[\">=\",frappe.utils.nowdate]},\"year\",(y)=>{\n    \t\t        frm.set_value(\"financial_year\",y.year)\n    \t\t})\n\t\t}\n\t}\n})",
  "view": "Form"
 },
 {
  "docstatus": 0,
  "doctype": "Client Script",
  "dt": "Purchase Receipt",
  "enabled": 1,
  "modified": "2021-07-27 11:20:56.150461",
  "name": "Purchase Receipt-Form",
  "parent": null,
  "parentfield": null,
  "parenttype": null,
  "script": "frappe.ui.form.on('Purchase Receipt', {\n\trefresh(frm) {\n\t    if(frm.doc.__islocal){\n    \t\tfrappe.db.get_value(\"Fiscal Year\",{\"disabled\":0,\"year_start_date\":[\"<=\",frm.doc.posting_date],\"year_end_date\":[\">=\",frm.doc.posting_date]},\"year\",(y)=>{\n    \t\t        frm.set_value(\"financial_year\",y.year)\n    \t\t})\n\t\t}\n\t}\n})",
  "view": "Form"
 },
 {
  "docstatus": 0,
  "doctype": "Client Script",
  "dt": "Payment Order",
  "enabled": 1,
  "modified": "2021-07-27 11:21:18.274625",
  "name": "Payment Order-Form",
  "parent": null,
  "parentfield": null,
  "parenttype": null,
  "script": "frappe.ui.form.on('Payment Order', {\n\trefresh(frm) {\n\t\t   if(frm.doc.__islocal){\n    \t\tfrappe.db.get_value(\"Fiscal Year\",{\"disabled\":0,\"year_start_date\":[\"<=\",frm.doc.posting_date],\"year_end_date\":[\">=\",frm.doc.posting_date]},\"year\",(y)=>{\n    \t\t        frm.set_value(\"financial_year\",y.year)\n    \t\t})\n\t\t}\n\t}\n})",
  "view": "Form"
 },
 {
  "docstatus": 0,
  "doctype": "Client Script",
  "dt": "Payment Entry",
  "enabled": 1,
  "modified": "2022-05-27 15:21:40.504087",
  "name": "Payment Entry-Form",
  "parent": null,
  "parentfield": null,
  "parenttype": null,
  "script": "frappe.ui.form.on('Payment Entry', {\n\trefresh(frm) {\n\t\t   if(frm.doc.__islocal){\n    \t\tfrappe.db.get_value(\"Fiscal Year\",{\"disabled\":0,\"year_start_date\":[\"<=\",frm.doc.posting_date],\"year_end_date\":[\">=\",frm.doc.posting_date]},\"year\",(y)=>{\n    \t\t        frm.set_value(\"financial_year\",y.year)\n    \t\t})\n\t\t}\n\t}\n})",
  "view": "Form"
 },
 {
  "docstatus": 0,
  "doctype": "Client Script",
  "dt": "Payment Request",
  "enabled": 1,
  "modified": "2021-07-27 11:21:53.054659",
  "name": "Payment Request-Form",
  "parent": null,
  "parentfield": null,
  "parenttype": null,
  "script": "frappe.ui.form.on('Payment Request', {\n\trefresh(frm) {\n\t\t   if(frm.doc.__islocal){\n    \t\tfrappe.db.get_value(\"Fiscal Year\",{\"disabled\":0,\"year_start_date\":[\"<=\",frm.doc.transaction_date],\"year_end_date\":[\">=\",frm.doc.transaction_date]},\"year\",(y)=>{\n    \t\t        frm.set_value(\"financial_year\",y.year)\n    \t\t})\n\t\t}\n\t}\n})",
  "view": "Form"
 },
 {
  "docstatus": 0,
  "doctype": "Client Script",
  "dt": "Quality Inspection",
  "enabled": 1,
  "modified": "2021-12-17 16:32:36.544925",
  "name": "Quality Inspection-Form",
  "parent": null,
  "parentfield": null,
  "parenttype": null,
  "script": "frappe.ui.form.on('Quality Inspection', {\n\treference_name(frm) {\n\t    if(frm.doc.reference_type == \"Purchase Receipt\" && frm.doc.reference_name != null){\n\t        frappe.db.get_value(\"Purchase Receipt\",{\"name\":frm.doc.reference_name},\"supplier\",(s)=>{\n    \t\t        frm.set_value(\"supplier\",s.supplier)\n    \t\t        frm.refresh_field(\"supplier\");\n    \t\t})\n\t    }\n\t},\n\trefresh(frm) {\n\t    if(frm.doc.reference_type == \"Purchase Receipt\" && frm.doc.reference_name != null && frm.doc.supplier == undefined && frm.doc.docstatus == 0){\n\t        frappe.db.get_value(\"Purchase Receipt\",{\"name\":frm.doc.reference_name},\"supplier\",(s)=>{\n    \t\t        frm.set_value(\"supplier\",s.supplier)\n    \t\t        frm.refresh_field(\"supplier\");\n    \t\t})\n\t    }\n\t}\n})",
  "view": "Form"
 },
 {
  "docstatus": 0,
  "doctype": "Client Script",
  "dt": "Item",
  "enabled": 1,
  "modified": "2021-12-28 12:10:28.558893",
  "name": "Item-Form",
  "parent": null,
  "parentfield": null,
  "parenttype": null,
  "script": "frappe.ui.form.on('Item', {\n    refresh: function(frm){\n        if(frm.doc.has_variants != 1 && frm.doc.__islocal != 1){\n            frm.add_custom_button(\"Generate Barcode\", function() {\n\t\t        frappe.call({\n    \t\t    type:\"POST\",\n    \t\t\targs:{\n    \t\t\t\t'item_code': frm.doc.item_code\n    \t\t\t},\n    \t\t\tasync:false,\n    \t\t\turl: \"/api/method/insert_barcode\",\n    \t\t\tcallback: function(r){\n\n    \t\t\t}\n    \t\t})\n    \t\tlocation.reload();\n\t        })\n        }\n\tfrm.set_query(\"style_number\",function(){\n        return{\n    \t\tfilters: {\n    \t\t    \"disabled\":[\"!=\",1],\n    \t\t  }\n        };\n    });\n    frm.set_query(\"item_group\",function(){\n        return{\n    \t\tfilters: {\n    \t\t    \"is_group\":[\"!=\",1],\n    \t\t  }\n        };\n    });\n    },\n\tbefore_save: function(frm){\n\t    var brand;\n\t    var year;\n\t    var collection;\n\t    var sub_category;\n\t    var category;\n\t    var style;\n\t    var res;\n\t    if(frm.doc.variant_of == undefined && frm.doc.is_finished_product == 1 && frm.doc.fabric_or_yarn != 1 && frm.doc.is_other_raw_material != 1){\n\t        brand = frm.doc.brand_code;\n\t        year = frm.doc.launch_year;\n\t        collection = frm.doc.collection_code;\n\t        style = frm.doc.style_number;\n\t        frappe.db.get_value(\"Item Group\",{\"name\":frm.doc.item_group},[\"sub_category_code\",\"parent_item_group\"],(s)=>{\n\t          sub_category=s.sub_category_code;\n\t          frappe.db.get_value(\"Item Group\",{\"name\":s.parent_item_group},\"category_code\",(c)=>{\n\t              category=c.category_code\n\t              if(category == undefined && sub_category != undefined){\n\t             res = brand.concat(year,collection,sub_category,style)\n\t              }else if(category != undefined && sub_category == undefined) {\n\t             res = brand.concat(year,collection,category,style)\n\t              }else if(category != undefined && sub_category != undefined) {\n\t             res = brand.concat(year,collection,category,sub_category,style)\n\t              }else if(category == undefined && sub_category == undefined) {\n\t             res = brand.concat(year,collection,style)\n\t              }\n\t              frm.set_value(\"item_code\",res);\n\t              frm.refresh_field(\"item_code\");\n\t          })\n\t        });\n\t    }\n\t    else{}\n\t    if(frm.doc.variant_of == undefined && frm.doc.is_finished_product != 1 && frm.doc.intermediate_product == 1 && frm.doc.fabric_or_yarn != 1 && frm.doc.is_other_raw_material != 1){\n\t        brand = frm.doc.brand_code;\n\t        year = frm.doc.launch_year;\n\t        collection = frm.doc.collection_code;\n\t        style = frm.doc.style_number;\n\t        frappe.db.get_value(\"Item Group\",{\"name\":frm.doc.item_group},[\"sub_category_code\",\"parent_item_group\"],(s)=>{\n\t          sub_category=s.sub_category_code;\n\t          frappe.db.get_value(\"Item Group\",{\"name\":s.parent_item_group},\"category_code\",(c)=>{\n\t              category=c.category_code\n\t              if(category == undefined && sub_category != undefined){\n\t             res = brand.concat(year,collection,sub_category,style)\n\t              }else if(category != undefined && sub_category == undefined) {\n\t             res = brand.concat(year,collection,category,style)\n\t              }else if(category != undefined && sub_category != undefined) {\n\t             res = brand.concat(year,collection,category,sub_category,style)\n\t              }else if(category == undefined && sub_category == undefined) {\n\t             res = brand.concat(year,collection,style)\n\t              }\n\t              frm.set_value(\"item_code\",\"I-\"+res);\n\t              frm.refresh_field(\"item_code\");\n\t          })\n\t        });\n\t    }\n\t    \n\t    if(frm.doc.variant_of == undefined && frm.doc.fabric_or_yarn == 1 && frm.doc.is_other_raw_material != 1){\n\t        var material = frm.doc.material;\n\t        var composition = frm.doc.composition;\n\t        var type = frm.doc.type;\n\t        var counts = frm.doc.count;\n\t        var process = frm.doc.process;\n\t        var weft_count = frm.doc.weft_count;\n\t        frappe.db.get_value(\"Item Group\",{\"name\":frm.doc.item_group},[\"sub_category_code\",\"parent_item_group\"],(s)=>{\n\t          sub_category=s.sub_category_code;\n\t          frappe.db.get_value(\"Item Group\",{\"name\":s.parent_item_group},\"category_code\",(c)=>{\n\t              category=c.category_code\n\t              if(category == undefined && sub_category != undefined){\n\t             res = sub_category.concat(\"-\",material,\"-\",type,\"-\",counts,\"-\",weft_count,\"-\",process)\n\t              }else if(category != undefined && sub_category == undefined) {\n\t             res = category.concat(\"-\",material,\"-\",type,\"-\",counts,\"-\",weft_count,\"-\",process)\n\t              }else if(category != undefined && sub_category != undefined) {\n\t             res = category.concat(\"-\",sub_category,\"-\",material,\"-\",type,\"-\",counts,\"-\",weft_count,\"-\",process)\n\t              }else if(category == undefined && sub_category == undefined) {\n\t             res = material.concat(\"-\",type,\"-\",counts,\"-\",weft_count,\"-\",process)\n\t              }\n\t              frm.set_value(\"item_code\",res);\n\t              frm.refresh_field(\"item_code\");\n\t          })\n\t        });\n\t    }\n\t    \n\t    if(frm.doc.variant_of == undefined && frm.doc.is_finished_product != 1 && frm.doc.intermediate_product != 1 && frm.doc.fabric_or_yarn != 1 && frm.doc.is_other_raw_material == 1){\n\t        var i_name = frm.doc.item_name;\n\t        frappe.db.get_value(\"Item Group\",{\"name\":frm.doc.item_group},[\"sub_category_code\",\"parent_item_group\"],(s)=>{\n\t          sub_category=s.sub_category_code;\n\t          frappe.db.get_value(\"Item Group\",{\"name\":s.parent_item_group},\"category_code\",(c)=>{\n\t              category=c.category_code\n\t              if(category == undefined && sub_category != undefined){\n\t             res = sub_category.concat(\"-\",i_name)\n\t              }else if(category != undefined && sub_category == undefined) {\n\t             res = category.concat(\"-\",i_name)\n\t              }else if(category != undefined && sub_category != undefined) {\n\t             res = category.concat(\"-\",sub_category,\"-\",i_name)\n\t              }else if(category == undefined && sub_category == undefined) {\n\t             res = i_name\n\t              }\n\t              frm.set_value(\"item_code\",res);\n\t              frm.refresh_field(\"item_code\");\n\t          })\n\t        });\n\t    }\n\t    \n\t    var count = 0;\n\t    if(frm.doc.has_variants == 1 && frm.doc.fabric_or_yarn != 1 && frm.doc.is_finished_product == 1 && frm.doc.is_other_raw_material != 1){\n\t        $.each(frm.doc.attributes, function(idx,item){\n\t            var name=item.attribute;\n\t            var str = name.toLowerCase();\n\t            if(str.includes(\"size\")){\n\t                count= count +1\n\t            }\n\t            if(str.includes(\"colour\") || str.includes(\"color\")){\n\t                count= count +1\n\t            }\n\t        })\n\t        if(count<2){\n\t            frappe.validate=false;\n\t            frappe.throw(__(\"For variants item, attributes table should have both colour and size attributes.\"))\n\t        }\n\t    }\n\t    count=0;\n\t    if(frm.doc.has_variants == 1 && frm.doc.intermediate_product == 1 && frm.doc.fabric_or_yarn != 1 && frm.doc.is_other_raw_material != 1){\n\t        $.each(frm.doc.attributes, function(idx,item){\n\t            var name=item.attribute;\n\t            var str = name.toLowerCase();\n\t            if(str.includes(\"size\")){\n\t                count= count +1\n\t            }\n\t            if(str.includes(\"colour\") || str.includes(\"color\")){\n\t                count= count +1\n\t            }\n\t            if(str.includes(\"stage\")){\n\t                count= count +1\n\t            }\n\t        })\n\t        if(count<3){\n\t            frappe.validate=false;\n\t            frappe.throw(__(\"For variants item, attributes table should have colour, size, stage attributes.\"))\n\t        }\n\t    }\n\t    count=0;\n\t    var i_group = frm.doc.item_group.toLowerCase();\n\t    if(frm.doc.has_variants == 1 && i_group.includes(\"fabric\") && frm.doc.fabric_or_yarn == 1 && frm.doc.is_other_raw_material != 1){\n\t        $.each(frm.doc.attributes, function(idx,item){\n\t            var name=item.attribute;\n\t            var str = name.toLowerCase();\n\t            if(str.includes(\"width\")){\n\t                count= count +1\n\t            }\n\t            if(str.includes(\"colour\") || str.includes(\"color\")){\n\t                count= count +1\n\t            }\n\t        })\n\t        if(count<2){\n\t            frappe.validate=false;\n\t            frappe.throw(__(\"For variants item, attributes table should have colour and width attributes.\"))\n\t        }\n\t    }\n\t    count=0;\n\t    if(frm.doc.has_variants == 1 && i_group.includes(\"yarn\") && frm.doc.fabric_or_yarn == 1 && frm.doc.is_other_raw_material != 1){\n\t        $.each(frm.doc.attributes, function(idx,item){\n\t            var name=item.attribute;\n\t            var str = name.toLowerCase();\n\t            if(str.includes(\"form\")){\n\t                count= count +1\n\t            }\n\t            if(str.includes(\"colour\") || str.includes(\"color\")){\n\t                count= count +1\n\t            }\n\t        })\n\t        if(count<2){\n\t            frappe.validate=false;\n\t            frappe.throw(__(\"For variants item, attributes table should have colour and form attributes.\"))\n\t        }\n\t    }\n\t}\n})\n\nfrappe.ui.form.on('Item Barcode', {\n\trefresh(frm) {\n\t},\n\tbefore_barcodes_remove: function(frm, cdt, cdn) {\n\t    var row = locals[cdt][cdn];\n\t    if(row.system_generated_barcode==1){\n    \t    frappe.validate = false;\n    \t \tfrappe.throw(__(\"Unable to delete the system generated Barcode.\"));\n\t    }\n\t}\n})\n",
  "view": "Form"
 },
 {
  "docstatus": 0,
  "doctype": "Client Script",
  "dt": "Delivery Note",
  "enabled": 1,
  "modified": "2021-12-23 19:19:04.855839",
  "name": "Delivery Note-Form",
  "parent": null,
  "parentfield": null,
  "parenttype": null,
  "script": "frappe.ui.form.on('Delivery Note', {\nrefresh: function(frm) {\n    if(frm.doc.__islocal){\n\t\tfrappe.db.get_value(\"Fiscal Year\",{\"disabled\":0,\"year_start_date\":[\"<=\",frm.doc.posting_date],\"year_end_date\":[\">=\",frm.doc.posting_date]},\"year\",(y)=>{\n\t\t        frm.set_value(\"financial_year\",y.year)\n\t\t})\n\t}\nset_css(frm);\n}\n});\n\nvar set_css = function (frm) {\n    $('input[data-fieldname=\"tracking_id\"]').css(\"color\",\"blue\")\n}\n",
  "view": "Form"
 },
 {
  "docstatus": 0,
  "doctype": "Client Script",
  "dt": "Packing Slip",
  "enabled": 1,
  "modified": "2022-01-06 20:14:34.178317",
  "name": "Packing Slip-Form",
  "parent": null,
  "parentfield": null,
  "parenttype": null,
  "script": "frappe.ui.form.on('Packing Slip', {\n\trefresh(frm) {\n\t    if(frm.doc.__islocal){\n    \t\tfrappe.db.get_value(\"Fiscal Year\",{\"disabled\":0,\"year_start_date\":[\"<=\",frappe.utils.nowdate],\"year_end_date\":[\">=\",frappe.utils.nowdate]},\"year\",(y)=>{\n    \t\t        frm.set_value(\"financial_year\",y.year)\n    \t\t})\n\t\t}\n\n\t\tif( frm.doc.delivery_note != undefined){\n            apply_filter(frm)\n\t    }\n\t    \n\n\t},\n\tdelivery_note(frm){\n\t    if( frm.doc.delivery_note != undefined){\n            apply_filter(frm)\n\t    }\n\t},\n\tbox_no(frm) {\n    \tif(frm.doc.items != undefined){\n    \t\t\tfor(var i =0;i<cur_frm.doc.items.length;i++){\n    \t\t\t\tcur_frm.doc.items[i].box_no=cur_frm.doc.box_no\n    \t\t\t}\n    \t\t}\n    \t}\n})\nfunction apply_filter(frm){\n\tvar si = []\n\n    frappe.call({\n\ttype:\"POST\",\n\targs:{\n\t\t\t'delivery_note': frm.doc.delivery_note\n\t\t},\n\tasync:false,\n\turl: \"/api/method/get_sales_invoice\",\n\tcallback: function(r){\n            for(var i=0;i<r.message.length;i++){\n\t\t\t\tsi.push(r.message[i].parent);\n\t\t\t}\n\t\t}\n\t})\n\t\n    frm.set_query(\"sales_invoice\",function(){\n\t\treturn{\n\t\t\tfilters: {\n\t\t\t\"name\":[\"in\",si]\n\t\t\t}\n\t\t};\n\t});\n}",
  "view": "Form"
 },
 {
  "docstatus": 0,
  "doctype": "Client Script",
  "dt": "Collection Details",
  "enabled": 1,
  "modified": "2021-10-26 13:11:21.629928",
  "name": "Collection Details-Form",
  "parent": null,
  "parentfield": null,
  "parenttype": null,
  "script": "frappe.ui.form.on('Collection Details', {\n\tbefore_save(frm) {\n    \tvar collection = frm.doc.collection_code;\n       if(/^[a-zA-Z]+$/.test(collection)){}\n        else{\n            frappe.validate=false;\n        \tfrappe.throw(__(\"The Collection Code should not be numeric or alphanumeric.\"))\n        }\n\t}\n})",
  "view": "Form"
 },
 {
  "docstatus": 0,
  "doctype": "Client Script",
  "dt": "Project",
  "enabled": 1,
  "modified": "2021-12-24 14:23:32.220452",
  "name": "Project-Form",
  "parent": null,
  "parentfield": null,
  "parenttype": null,
  "script": "frappe.ui.form.on('Project', {\n    setup(frm) {\n\t\tfrm.make_methods = {\n\t\t\t'Timesheet': () => {\n\t\t\t\topen_form(frm, \"Timesheet\", \"Timesheet Detail\", \"time_logs\");\n\t\t\t},\n\t\t\t'Purchase Order': () => {\n\t\t\t\topen_form(frm, \"Purchase Order\", \"Purchase Order Item\", \"items\");\n\t\t\t},\n\t\t\t'Purchase Receipt': () => {\n\t\t\t\topen_form(frm, \"Purchase Receipt\", \"Purchase Receipt Item\", \"items\");\n\t\t\t},\n\t\t\t'Purchase Invoice': () => {\n\t\t\t\topen_form(frm, \"Purchase Invoice\", \"Purchase Invoice Item\", \"items\");\n\t\t\t},\n\t\t\t'Material Request': () => {\n\t\t\t\topen_form(frm, \"Material Request\", \"Material Request Item\", \"items\");\n\t\t\t},\n\t\t\t'Timesheet': () => {\n\t\t\t\topen_form(frm, \"Timesheet\", \"Timesheet Detail\", \"time_logs\");\n\t\t\t},\n\t\t\t'Delivery Note': () => {\n\t\t\t\topen_form(frm, \"Delivery Note\", \"Delivery Note Item\", \"items\");\n\t\t\t},\n\t\t\t'Sales Invoice': () => {\n\t\t\t\topen_form(frm, \"Sales Invoice\", \"Sales Invoice Item\", \"items\");\n\t\t\t},\n\t\t};\n\t},\n\trefresh(frm) {\n\t}\n})\n\nfunction open_form(frm, doctype, child_doctype, parentfield) {\n\tfrappe.model.with_doctype(doctype, () => {\n\t    let new_doc = frappe.model.get_new_doc(doctype);\n\t    if ( doctype == 'Timesheet'){\n            new_doc.parent_project=frm.doc.name;\n\t    }else{\n        new_doc.project=frm.doc.name;\n\t    }\n\t\t// add a new row and set the project\n\t\tlet new_child_doc = frappe.model.get_new_doc(child_doctype);\n\t\tnew_child_doc.project = frm.doc.name;\n\t\tnew_child_doc.parent = new_doc.name;\n\t\tnew_child_doc.parentfield = parentfield;\n\t\tnew_child_doc.parenttype = doctype;\n\t\tnew_doc[parentfield] = [new_child_doc];\n\n\t\tfrappe.ui.form.make_quick_entry(doctype, null, null, new_doc);\n\t});\n\n}",
  "view": "Form"
 },
 {
  "docstatus": 0,
  "doctype": "Client Script",
  "dt": "Location",
  "enabled": 1,
  "modified": "2022-07-25 13:39:52.070757",
  "name": "Location-Form",
  "parent": null,
  "parentfield": null,
  "parenttype": null,
  "script": "frappe.ui.form.on('Location', {\naddress: function(frm) {\n    if (frm.doc.address) {\n        frappe.call({\n            method: 'frappe.contacts.doctype.address.address.get_address_display',\n            args: {\n                \"address_dict\": frm.doc.address\n            },\n            callback: function(r) {\n                frm.set_value(\"address_display\", r.message);\n            }\n        });\n    }\n    if (!frm.doc.address) {\n        frm.set_value(\"address_display\", \"\");\n    }\n}\n})",
  "view": "Form"
 },
 {
  "docstatus": 0,
  "doctype": "Client Script",
  "dt": "Stock Entry",
  "enabled": 1,
  "modified": "2022-07-04 11:55:43.813215",
  "name": "Stock Entry-Form",
  "parent": null,
  "parentfield": null,
  "parenttype": null,
  "script": "frappe.ui.form.on('Stock Entry', {\n\trefresh(frm, cdt, cdn) {\n\t    if(frm.doc.__islocal){\n    \t\tfrappe.db.get_value(\"Fiscal Year\",{\"disabled\":0,\"year_start_date\":[\"<=\",frm.doc.posting_date],\"year_end_date\":[\">=\",frm.doc.posting_date]},\"year\",(y)=>{\n    \t\t        frm.set_value(\"financial_year\",y.year)\n    \t\t})\n\t\t}\t   \n\t    if(frm.doc.net_total < 1){\n            calculate_nettotal_and_total(frm,cdt,cdn);\n        }\n\t\n\t    var df = frappe.meta.get_docfield(\"Sales Taxes and Charges\", \"charge_type\", cur_frm.doc.name);\n        df.read_only = 1;\n        \n        frm.set_query(\"transporter\",function(){\n\t\t    return{\n\t\t\t    filters: {\n\t\t\t    \"is_transporter\":1\n\t\t\t    }\n\t\t    };\n\t    });\n\t    frm.set_query(\"driver\",function(){\n\t\t    return{\n\t\t\t    filters: {\n\t\t\t    \"transporter\":frm.doc.transporter\n\t\t\t    }\n\t\t    };\n\t    });\n\t    if (frm.doc.stock_entry_type == 'Send to Subcontractor') {\n            frappe.db.get_value(\"Purchase Order\", frm.doc.purchase_order, \"supplier\",(s)=>{\n                console.log(s.supplier);\n                frm.set_value(\"suppliers_name\", s.supplier)\n        });\n    }\n\t},\nsuppliers_name: function (frm) {\n\n    frm.set_query(\"suppliers_address\", function(doc) {\n        return {\n            filters: {\n                \"link_doctype\": \"Supplier\",\n                \"link_name\": doc.suppliers_name\n            }\n        };\n    });\n},\nsuppliers_address: function(frm) {\n    if (frm.doc.suppliers_address) {\n        frappe.call({\n            method: 'frappe.contacts.doctype.address.address.get_address_display',\n            args: {\n                \"address_dict\": frm.doc.suppliers_address\n            },\n            callback: function(r) {\n                frm.set_value(\"suppliers_address_details\", r.message);\n            }\n        });\n    }\n    if (!frm.doc.suppliers_address) {\n        frm.set_value(\"suppliers_address_details\", \"\");\n    }\n}\n    \n})\n\nfrappe.ui.form.on('Stock Entry Detail', {\n\tbasic_rate:function(frm, cdt, cdn){\n\t    calculate_nettotal_and_total(frm,cdt,cdn);\n    },\n    qty:function(frm, cdt, cdn){\n       calculate_nettotal_and_total(frm,cdt,cdn);\n    },\n   items_remove:function(frm, cdt, cdn){\n       calculate_nettotal_and_total(frm,cdt,cdn);\n   \t}\n})\n\nfrappe.ui.form.on('Sales Taxes and Charges', {\n\trate:function(frm, cdt, cdn) {\n\t\tupdate_net_total(frm,cdt,cdn);\n\t\tcalculate_tax_rate(frm,cdt,cdn);\n\t},\n\tincluded_in_print_rate:function(frm,cdt,cdn){\n\t\tupdate_net_total(frm,cdt,cdn);\n\t\tcalculate_tax_rate(frm,cdt,cdn);\t    \n\t},\n\ttaxes_remove:function(frm, cdt, cdn){\n\t    update_net_total(frm,cdt,cdn);\n\t\tcalculate_tax_rate(frm,cdt,cdn);\n\t},\n\taccount_head:function(frm,cdt,cdn){\n\t    var d = locals[cdt][cdn];\n\t    let ac_head = d.account_head;\n\t    if(d.account_head != null){\n    \t    if(ac_head.includes(\"%\")){\n    \t        const desc = ac_head.split(\"%\");\n    \t        d.description = desc[0]+\"%\" ;\n    \t    }else{\n    \t        d.description = ac_head;\n    \t    }\n    \t    refresh_field(\"taxes\");\n\t    }\n\t},\n\ttaxes_add:function(frm, cdt, cdn){\n\t    var d = locals[cdt][cdn];\n\t    d.charge_type = \"On Net Total\";\n\t    refresh_field(\"taxes\");\n\t}\n})\n\nfunction calculate_nettotal_and_total(frm,cdt,cdn){\n   var d = locals[cdt][cdn];\n   var total = 0;\n   frm.doc.items.forEach(function(d) { total += (d.qty*d.basic_rate); });\n   frm.set_value(\"net_total\", total);\n   refresh_field(\"net_total\");\n   frm.set_value(\"total\", total);\n   refresh_field(\"total\");\n}\n\nfunction update_net_total(frm,cdt,cdn){\n\tvar d = locals[cdt][cdn];\n\tvar total_rate = 0;\n\tfrm.doc.taxes.forEach(function(d) {\n\t\tif(d.included_in_print_rate == 1 && d.rate != undefined){\n\t\t\ttotal_rate += d.rate; \n\t\t} \n\t});\n\tif(total_rate > 0){\n\t\tvar total_amt = 0;\n\t\ttotal_amt = (frm.doc.total - ((frm.doc.total* total_rate)/(100+total_rate)));\n    \tfrm.set_value(\"net_total\",total_amt);\n    \trefresh_field(\"net_total\");\n\t}else{\n\t\tfrm.set_value(\"net_total\",frm.doc.total);\n\t\trefresh_field(\"net_total\");\n\t}\n}\n    \nfunction calculate_tax_rate(frm,cdt,cdn){\n    var d = locals[cdt][cdn];\n    var total_tax_amt = frm.doc.net_total;\n    $.each(frm.doc.taxes, function(idx, item){\n        var tax_amt = 0;\n\t\ttax_amt = frm.doc.net_total * (item.rate/100);\n\t\titem.tax_amount = tax_amt;\n\t\ttotal_tax_amt += tax_amt;\n\t\titem.total = total_tax_amt;\n    })\n    refresh_field(\"taxes\");\n}\n",
  "view": "Form"
 },
 {
  "docstatus": 0,
  "doctype": "Client Script",
  "dt": "Material Request",
  "enabled": 1,
  "modified": "2022-04-27 16:23:52.552899",
  "name": "Material Request-Form",
  "parent": null,
  "parentfield": null,
  "parenttype": null,
  "script": "frappe.ui.form.on('Material Request', {\n\trefresh(frm) {\n\t    if(frm.doc.__islocal){\n    \t\tfrappe.db.get_value(\"Fiscal Year\",{\"disabled\":0,\"year_start_date\":[\"<=\",frm.doc.transaction_date],\"year_end_date\":[\">=\",frm.doc.transaction_date]},\"year\",(y)=>{\n    \t\t        frm.set_value(\"financial_year\",y.year)\n    \t\t})\n\t\t}\n\t\t\n\t},\n\tblanket_order:function(frm,cdt,cdn){\n\t    if(frm.doc.blanket_order != null && frm.doc.blanket_order != undefined){\n            $.each(frm.doc.items, function(idx, item){\n                \n        \t\titem.blanket_order = frm.doc.blanket_order;\n            })\n            refresh_field(\"items\");\n\t    }\n\t},\n\tproject:function(frm,cdt,cdn){\n\t    if(frm.doc.project!=null && frm.doc.project != undefined){\n\t        $.each(frm.doc.items, function(idx, item){\n\t            item.project = frm.doc.project;\n\t        });\n\t    }\n\t    refresh_field(\"items\");\n\t},\n\tbefore_workflow_action:async(frm)=>{\n\t    if(frm.selected_workflow_action == 'Cancel'){\n\t        let promise = new Promise((resolve, reject) =>{\n\t            frappe.confirm(\n\t                __(\"Permanently Cancel \"+String(frm.doc.name)+\" ?\"),\n\t                ()=> resolve(),\n\t                () => reject()\n\t                );\n\t        });\n\t        await promise.catch(() => frappe.throw());\n\t    }\n\t    \n\t}\n})\n\nfrappe.ui.form.on('Material Request Item', {\n\titems_add:function(frm,cdt,cdn){\n\t    if(frm.doc.blanket_order != null && frm.doc.blanket_order != undefined){\n            $.each(frm.doc.items, function(idx, item){\n                \n        \t\titem.blanket_order = frm.doc.blanket_order;\n            })\n            refresh_field(\"items\");\n\t    }\n\t}\n})",
  "view": "Form"
 },
 {
  "docstatus": 0,
  "doctype": "Client Script",
  "dt": "Production Plan",
  "enabled": 1,
  "modified": "2022-06-16 14:51:29.155071",
  "name": "Production Plan-Form",
  "parent": null,
  "parentfield": null,
  "parenttype": null,
  "script": "frappe.ui.form.on('Production Plan', {\n\tbefore_save(frm) {\n\t\t$.each(frm.doc.sub_assembly_items,function(idx, item){\n\t\t var value = item.schedule_date.split(' ')[0]\n\t\t    if(item.schedule_date && !frappe.datetime.validate(value)) {\n    \t\t\tlet sysdefaults = frappe.sys_defaults;\n    \t\t\tlet date_format = sysdefaults && sysdefaults.date_format\n    \t\t\t\t? sysdefaults.date_format : 'yyyy-mm-dd';\n    \t\t\tfrappe.validate=false;\n    \t\t\tfrappe.throw(__(\"Sub Assembly Item <br> Row:{0} Schedule Date {1} must be in format: {2}\", [idx+1, item.schedule_date, date_format]));\n\t\t    }\n\t\t});\n\t}\n})",
  "view": "Form"
 },
 {
  "docstatus": 0,
  "doctype": "Client Script",
  "dt": "Purchase Invoice",
  "enabled": 1,
  "modified": "2022-06-27 17:02:53.995065",
  "name": "Purchase Invoice-Form",
  "parent": null,
  "parentfield": null,
  "parenttype": null,
  "script": "frappe.ui.form.on('Purchase Invoice', {\n\trefresh(frm) {\n\t    if(frm.doc.__islocal){\n    \t\tfrappe.db.get_value(\"Fiscal Year\",{\"disabled\":0,\"year_start_date\":[\"<=\",frm.doc.posting_date],\"year_end_date\":[\">=\",frm.doc.posting_date]},\"year\",(y)=>{\n    \t\t        frm.set_value(\"financial_year\",y.year)\n    \t\t})\n    \t\t\n    \t\tset_company_address(frm);\n\t\t}\n\t\tcompany_address_filter(frm);\n\t\t\n\n\t},\n\tbranch(frm){\n\t    company_address_filter(frm);\n\t    set_company_address(frm);\n\t},\n\ttaxes_and_charges: function(frm, cdt, cdn) {\n        var row = locals[cdt][cdn];\n        \n        frappe.db.get_value('Purchase Taxes and Charges Template', row.taxes_and_charges, 'is_rcm')\n        .then(r => {\n            if(r.message.is_rcm == 1){\n                row.reverse_charge = 'Y';\n            }\n            else{\n                row.reverse_charge = 'N';\n            }\n            \n        });\n    }\n});\n\nfunction company_address_filter(frm){\n    var branch_address = [];\n    frappe.db.get_value(\"Branch\",{\"name\":frm.doc.branch},\"address\",(a)=>{\n        branch_address.push(a.address);\n    });\n    frm.set_query(\"billing_address\",function(){\n        if (frm.doc.branch){\n            return{\n                filters:{\n                    \"name\":[\"in\",branch_address]\n                }\n            }\n        }else{\n            return{\n                filters:{\n                    \n                }\n            }\n        }\n        });\n}\n\nfunction set_company_address(frm){\n    frappe.db.get_value(\"Branch\",{\"name\":frm.doc.branch},\"address\",(a)=>{\n        frm.set_value(\"billing_address\",a.address)\n    });\n}",
  "view": "Form"
 },
 {
  "docstatus": 0,
  "doctype": "Client Script",
  "dt": "Sales Order",
  "enabled": 1,
  "modified": "2022-06-27 17:09:09.288502",
  "name": "Sales Order-Form",
  "parent": null,
  "parentfield": null,
  "parenttype": null,
  "script": "frappe.ui.form.on('Sales Order', {\n\trefresh(frm) {\n\t    if(frm.doc.__islocal){\n    \t\tfrappe.db.get_value(\"Fiscal Year\",{\"disabled\":0,\"year_start_date\":[\"<=\",frm.doc.transaction_date],\"year_end_date\":[\">=\",frm.doc.transaction_date]},\"year\",(y)=>{\n    \t\t        frm.set_value(\"financial_year\",y.year)\n    \t\t})\n    \t\tset_company_address(frm);\n\t\t}\n\t\tcompany_address_filter(frm);\n\t\t\n\t\t\n\t\t\n        \n\t},\n\tbranch(frm){\n\t    company_address_filter(frm);\n\t    set_company_address(frm);\n\t}\n});\n\nfunction company_address_filter(frm){\n    var branch_address = [];\n    frappe.db.get_value(\"Branch\",{\"name\":frm.doc.branch},\"address\",(a)=>{\n        branch_address.push(a.address);\n    });\n    frm.set_query(\"company_address\",function(){\n        if (frm.doc.branch){\n            return{\n                filters:{\n                    \"name\":[\"in\",branch_address]\n                }\n            }\n        }else{\n            return{\n                filters:{\n                    \n                }\n            }\n        }\n        });\n}\n\nfunction set_company_address(frm){\n    frappe.db.get_value(\"Branch\",{\"name\":frm.doc.branch},\"address\",(a)=>{\n        frm.set_value(\"company_address\",a.address)\n    });\n}",
  "view": "Form"
 },
 {
  "docstatus": 0,
  "doctype": "Client Script",
  "dt": "Sales Invoice",
  "enabled": 1,
  "modified": "2022-06-27 17:36:01.072485",
  "name": "Sales Invoice-Form",
  "parent": null,
  "parentfield": null,
  "parenttype": null,
  "script": "frappe.ui.form.on('Sales Invoice', {\n    address_query: function(frm, link_doctype, link_name) {\n\t\treturn {\n\t\t\tquery: 'frappe.contacts.doctype.address.address.address_query',\n\t\t\tfilters: {\n\t\t\t\tlink_doctype: link_doctype,\n\t\t\t\tlink_name: link_name\n\t\t\t}\n\t\t};\n\t},\n\tcontact_query: function(frm, link_doctype, link_name) {\n\t\treturn {\n\t\t\tquery: 'frappe.contacts.doctype.contact.contact.contact_query',\n\t\t\tfilters: {\n\t\t\t\tlink_doctype: link_doctype,\n\t\t\t\tlink_name: link_name\n\t\t\t}\n\t\t};\n\t},\n\trefresh(frm) {\n\t    if(frm.doc.customer != undefined && frm.doc.customer != null){\n\t    frm.set_query(\"notif_party_one_address\", () => {\n\t\t\treturn frm.events.address_query(frm, 'Customer', frm.doc.customer);\n\t\t});\n\t\tfrm.set_query(\"notif_party_two_address\", () => {\n\t\t\treturn frm.events.address_query(frm, 'Customer', frm.doc.customer);\n\t\t});\n\t\tfrm.set_query(\"notif_party_one_contact\", () => {\n\t\t\treturn frm.events.contact_query(frm, 'Customer', frm.doc.customer);\n\t\t});\n\t\tfrm.set_query(\"notif_party_two_contact\", () => {\n\t\t\treturn frm.events.contact_query(frm, 'Customer', frm.doc.customer);\n\t\t});\n\t    }\n\t   if(frm.doc.__islocal){\n    \t\tfrappe.db.get_value(\"Fiscal Year\",{\"disabled\":0,\"year_start_date\":[\"<=\",frm.doc.posting_date],\"year_end_date\":[\">=\",frm.doc.posting_date]},\"year\",(y)=>{\n    \t\t        frm.set_value(\"financial_year\",y.year)\n    \t\t})\n    \t\tset_company_address(frm);\n\t\t}\n\t    if(frm.doc.delivery_note == undefined)\n\t\t$.each(frm.doc.items,function(idx, item){\n            if(item.delivery_note != undefined){\n                frm.set_value(\"delivery_note\",item.delivery_note)\n            }\n\t\t});\n\t\t\n\t\tcompany_address_filter(frm);\n\t\t\n\t\t\n\t\tfrm.set_query(\"dispatch_address_name\",function(){\n        return{\n    \t\tfilters: {\n    \t\t    \n    \t\t  }\n        };\n        });\n        \n        frm.set_query(\"bank_account\",function(){\n            if (!frm.doc.branch){\n                return{\n            \t\tfilters: {\n            \t\t    \"is_company_account\" : 1\n            \t\t  }\n                };\n            }\n            else{\n                return{\n            \t\tfilters: {\n            \t\t    \"is_company_account\" : 1,\n            \t\t    \"branch\" : frm.doc.branch\n            \t\t  }\n                };\n            }\n        });\n        \n        if (frm.doc.branch && !frm.doc.bank_account && frm.doc.docstatus < 1){\n            frappe.db.get_value(\"Bank Account\",{\"is_company_account\" : 1, \"branch\":frm.doc.branch,\"is_default\":1},\"name\",(db)=>{\n                frm.set_value(\"bank_account\",db.name);\n                if (!db.name){\n                    frappe.db.get_value(\"Bank Account\",{\"is_company_account\" : 1, \"branch\":frm.doc.branch},\"name\",(b)=>{\n                        frm.set_value(\"bank_account\",b.name);\n                    });\n                }\n                refresh_field(\"bank_account\");\n            });\n            \n        }\n        else if(!frm.doc.branch && !frm.doc.bank_account && frm.doc.docstatus < 1){\n            frappe.db.get_value(\"Bank Account\",{\"is_company_account\" : 1},\"name\",(ba)=>{\n                frm.set_value(\"bank_account\",ba.name);\n                refresh_field(\"bank_account\");\n            });\n        }\n        \n        if (frm.doc.is_return == 1 && frm.doc.delivery_note && frm.doc.__islocal){\n            frm.set_value(\"naming_series\",\"SIR/.financial_year./.branch_abbr.####\")\n        }\n\t},\n\tbranch(frm){\n\t    company_address_filter(frm);\n\t\t\n\t\tset_company_address(frm);\n\t\t\n\t    if (frm.doc.branch && frm.doc.docstatus < 1){\n            frappe.db.get_value(\"Bank Account\",{\"is_company_account\" : 1, \"branch\":frm.doc.branch,\"is_default\":1},\"name\",(db)=>{\n                frm.set_value(\"bank_account\",db.name);\n                if (!db.name){\n                    frappe.db.get_value(\"Bank Account\",{\"is_company_account\" : 1, \"branch\":frm.doc.branch},\"name\",(b)=>{\n                        frm.set_value(\"bank_account\",b.name);\n                    });\n                }\n                refresh_field(\"bank_account\");\n            });\n        }\n\t}\n})\n\nfunction company_address_filter(frm){\n    var branch_address = [];\n    frappe.db.get_value(\"Branch\",{\"name\":frm.doc.branch},\"address\",(a)=>{\n        branch_address.push(a.address);\n    });\n    frm.set_query(\"company_address\",function(){\n        if (frm.doc.branch){\n            return{\n                filters:{\n                    \"name\":[\"in\",branch_address]\n                }\n            }\n        }else{\n            return{\n                filters:{\n                    \n                }\n            }\n        }\n        });\n}\n\nfunction set_company_address(frm){\n    frappe.db.get_value(\"Branch\",{\"name\":frm.doc.branch},\"address\",(a)=>{\n        frm.set_value(\"company_address\",a.address)\n    });\n}",
  "view": "Form"
 },
 {
  "docstatus": 0,
  "doctype": "Client Script",
  "dt": "Purchase Order",
  "enabled": 1,
  "modified": "2022-06-27 17:32:58.433644",
  "name": "Purchase Order-Form",
  "parent": null,
  "parentfield": null,
  "parenttype": null,
  "script": "frappe.ui.form.on('Purchase Order', {\n\trefresh(frm) {\n\t    if(frm.doc.__islocal){\n    \t\tfrappe.db.get_value(\"Fiscal Year\",{\"disabled\":0,\"year_start_date\":[\"<=\",frm.doc.transaction_date],\"year_end_date\":[\">=\",frm.doc.transaction_date]},\"year\",(y)=>{\n    \t\t        frm.set_value(\"financial_year\",y.year)\n    \t\t})\n    \t\tset_company_address(frm);\n\t\t}\n\t\tcompany_address_filter(frm);\n\t\t\n\t\t\n\t\tfrm.set_query(\"shipping_address\",function(){\n        return{\n    \t\tfilters: {\n    \t\t    \n    \t\t  }\n        };\n        });\n\t},\n    branch:function(frm,cdt,cdn){\n        company_address_filter(frm);\n\t\t\n\t\tset_company_address(frm);\n\t\t\n\t    if(frm.doc.branch!=null && frm.doc.branch != undefined){\n\t        $.each(frm.doc.items, function(idx, item){\n\t            item.branch = frm.doc.branch;\n\t        });\n\t    }\n\t    refresh_field(\"items\");\n\t},\n\tproject:function(frm,cdt,cdn){\n\t    if(frm.doc.project!=null && frm.doc.project != undefined){\n\t        $.each(frm.doc.items, function(idx, item){\n\t            item.project = frm.doc.project;\n\t        });\n\t    }\n\t    refresh_field(\"items\");\n\t},\n\tschedule_date(frm){\n\t    if(frm.doc.schedule_date != undefined && frm.doc.schedule_date != null){\n\t        $.each(frm.doc.items, function(idx, item){\n\t            item.schedule_date = frm.doc.schedule_date;\n\t        });\n\t    }\n\t}\n})\n\n\nfrappe.ui.form.on('Purchase Order Item', {\n\titems_add:function(frm,cdt,cdn){\n\t    if(frm.doc.project != null && frm.doc.project != undefined){\n            $.each(frm.doc.items, function(idx, item){\n                \n        \t\titem.project = frm.doc.project;\n        \t\titem.branch = frm.doc.branch;\n            })\n            refresh_field(\"items\");\n\t    }\n\t}\n})\n\nfunction company_address_filter(frm){\n    var branch_address = [];\n    frappe.db.get_value(\"Branch\",{\"name\":frm.doc.branch},\"address\",(a)=>{\n        branch_address.push(a.address);\n    });\n    frm.set_query(\"billing_address\",function(){\n        if (frm.doc.branch){\n            return{\n                filters:{\n                    \"name\":[\"in\",branch_address]\n                }\n            }\n        }else{\n            return{\n                filters:{\n                    \n                }\n            }\n        }\n        });\n}\n\nfunction set_company_address(frm){\n    frappe.db.get_value(\"Branch\",{\"name\":frm.doc.branch},\"address\",(a)=>{\n        frm.set_value(\"billing_address\",a.address)\n    });\n}",
  "view": "Form"
 },
 {
  "docstatus": 0,
  "doctype": "Client Script",
  "dt": "Training Result",
  "enabled": 1,
  "modified": "2022-07-22 12:45:23.773194",
  "name": "Training Result-Form",
  "parent": null,
  "parentfield": null,
  "parenttype": null,
  "script": "frappe.ui.form.on('Training Result', {\n    \n    onload: function(frm) {\n        if (frm.doc.is_artisan_training == 0){\n            frm.set_query(\"training_event\",function(){\n    \t\t\treturn{\n    \t\t\t\tfilters: {\n    \t\t\t\t\t\"is_artisan_training\":0\n    \t\t\t\t}\n    \t\t\t};\n    \t\t});\n    \t}\n\t\tfrm.trigger(\"training_event\");\n\t},\n\n\ttraining_event: function(frm) {\n\t\tfrm.trigger(\"training_event\");\n\t},\n\n\ttraining_event: function(frm) {\n\tif (frm.doc.training_event && !frm.doc.docstatus && !frm.doc.artisans) {\n\t\tfrappe.call({\n\t\t\tmethod: \"rangsutra.rangsutra.doctype.training_result.training_result.get_artisans\",\n\t\t\targs: {\n\t\t\t\t\"training_event\": frm.doc.training_event\n\t\t\t},\n\t\t\tcallback: function(r) {\n\t\t\t\tfrm.set_value(\"artisans\" ,\"\");\n\t\t\t\tif (r.message) {\n                    console.log(r);\n\t\t\t\t\t$.each(r.message, function(i, d) {\n\t\t\t\t\t\tvar row = frappe.model.add_child(frm.doc, \"Training Result Artisan\", \"artisans\");\n\t\t\t\t\t\trow.artisan = d.artisan;\n\t\t\t\t\t\trow.artisan_name = d.artisan_name;\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t\trefresh_field(\"artisans\");\n\t\t\t}\n\t\t});\n\t}\n\t},\n\n\tis_artisan_training: function(frm) {\n        if (frm.doc.is_artisan_training == 1){\n    \n            frm.set_query(\"training_event\",function(){\n    \t\t\treturn{\n    \t\t\t\tfilters: {\n    \t\t\t\t\t\"is_artisan_training\":1\n    \t\t\t\t}\n    \t\t\t};\n    \t\t});\n    \t}\n    \telse {\n    \t   if (frm.doc.is_artisan_training == 0){\n                frm.set_query(\"training_event\",function(){\n        \t\t\treturn{\n        \t\t\t\tfilters: {\n        \t\t\t\t\t\"is_artisan_training\":0\n        \t\t\t\t}\n        \t\t\t};\n        \t\t});\n    \t    }\n    \t}\n\t}\n})\n",
  "view": "Form"
 },
 {
  "docstatus": 0,
  "doctype": "Client Script",
  "dt": "Training Feedback",
  "enabled": 1,
  "modified": "2022-07-22 12:45:35.486766",
  "name": "Training Feedback-Form",
  "parent": null,
  "parentfield": null,
  "parenttype": null,
  "script": "frappe.ui.form.on('Training Feedback', {\n\tis_artisan_training: function(frm) {\n        if (frm.doc.is_artisan_training == 1){\n    \n            frm.set_query(\"training_event\",function(){\n    \t\t\treturn{\n    \t\t\t\tfilters: {\n    \t\t\t\t\t\"is_artisan_training\":1\n    \t\t\t\t}\n    \t\t\t};\n    \t\t});\n    \t}\n    \telse {\n    \t   if (frm.doc.is_artisan_training == 0){\n                frm.set_query(\"training_event\",function(){\n        \t\t\treturn{\n        \t\t\t\tfilters: {\n        \t\t\t\t\t\"is_artisan_training\":0\n        \t\t\t\t}\n        \t\t\t};\n        \t\t});\n    \t    }\n    \t}\n\t}\n})",
  "view": "Form"
 },
 {
  "docstatus": 0,
  "doctype": "Client Script",
  "dt": "Artisan",
  "enabled": 1,
  "modified": "2022-07-26 15:07:57.288711",
  "name": "Artisan-Form",
  "parent": null,
  "parentfield": null,
  "parenttype": null,
  "script": "frappe.ui.form.on('Artisan', {\n\trefresh(frm) {\n\t\t// your code here\n\tfrm.set_query(\"supplier\", function() {\n            return {\n                filters: [\n                    [\"Location Info\", \"location_display\", \"=\", frm.doc.location]\n\n                ]\n            };\n        });\n\t}\n})",
  "view": "Form"
 }
]